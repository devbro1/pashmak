"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[725],{2491(e,n,a){a.d(n,{A:()=>o});a(3696);var t=a(1750);const r="tabItem_wHwb";var s=a(2540);function o({children:e,hidden:n,className:a}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(r,a),hidden:n,children:e})}},3023(e,n,a){a.d(n,{R:()=>o,x:()=>i});var t=a(3696);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},5757(e,n,a){a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"database/db_setup","title":"Setup Database","description":"install drivers","source":"@site/docs/database/db_setup.md","sourceDirName":"database","slug":"/database/db_setup","permalink":"/pashmak/docs/database/db_setup","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/database/db_setup.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Database/ORM","permalink":"/pashmak/docs/category/databaseorm"},"next":{"title":"Database Migrations","permalink":"/pashmak/docs/database/db_migration"}}');var r=a(2540),s=a(3023),o=a(8296),i=a(2491);const l={sidebar_position:1},c="Setup Database",u={},d=[{value:"install drivers",id:"install-drivers",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Applying migrations",id:"applying-migrations",level:2},{value:"Eager vs Lazy Connection",id:"eager-vs-lazy-connection",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"setup-database",children:"Setup Database"})}),"\n",(0,r.jsx)(n.h2,{id:"install-drivers",children:"install drivers"}),"\n",(0,r.jsxs)(n.p,{children:["Pashmak uses ",(0,r.jsx)(n.code,{children:"neko-sql"})," and ",(0,r.jsx)(n.code,{children:"neko-orm"})," packages for database drivers. to keep the size of original package small, each database driver is peerDependency that you need to install separately based on the type of database you like to use:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Postgresql:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/pg",children:"pg"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/pg-cursor",children:"pg-cursor"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Mysql","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/mysql2",children:"mysql2"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["sqlite","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/better-sqlite3",children:"better-sqlite3"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"If you are planning to connect to a database using Pashmak SQL library, first you need to define your db access:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// src/config/databases.ts\n\nexport default {\n  default: {\n    provider: "postgresql",\n    config: {\n      host: process.env.DB_HOST,\n      database: process.env.DB_NAME || "test_db",\n      user: process.env.DB_USER,\n      password: process.env.DB_PASSWORD,\n      port: parseInt(process.env.DB_PORT || "5432"),\n    },\n  },\n};\n\nexport const $test = {\n  default: {\n    provider: "postgresql",\n    config: {\n      host: process.env.TEST_DB_HOST,\n      database: process.env.TEST_DB_NAME || "test_db",\n      user: process.env.TEST_DB_USER,\n      password: process.env.TEST_DB_PASSWORD,\n      port: parseInt(process.env.TEST_DB_PORT || "5432"),\n    },\n  },\n};\n'})}),"\n",(0,r.jsx)(n.h2,{id:"applying-migrations",children:"Applying migrations"}),"\n","\n",(0,r.jsx)(n.p,{children:"To initially setup your database and run migrations:"}),"\n",(0,r.jsxs)(o.A,{groupId:"package-manager",children:[(0,r.jsx)(i.A,{value:"npm",label:"npm",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm run dev\n# Then in another terminal\npashmak migrate\n"})})}),(0,r.jsx)(i.A,{value:"yarn",label:"Yarn",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn dev\n# Then in another terminal\npashmak migrate\n"})})}),(0,r.jsx)(i.A,{value:"pnpm",label:"pnpm",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm dev\n# Then in another terminal\npashmak migrate\n"})})})]}),"\n",(0,r.jsx)(n.h2,{id:"eager-vs-lazy-connection",children:"Eager vs Lazy Connection"}),"\n",(0,r.jsx)(n.p,{children:"Eager logic is where we do something ahead of when it is needed. For example database connection is opened at the beginning request processing to be ready for any database query that will be made. It is beneficial to improve performance at the risk of allocating resources that may not be used."}),"\n",(0,r.jsx)(n.p,{children:"Pashmak takes the route of lazy logic when it comes to database. Connection to database is not established until the first query needs to run. If your request results in no query execution, no connection to database will be made. This is mainly useful to save resources and gives you opportunity to end a request if there are issues with the request such as bad authentication or invalid body."}),"\n",(0,r.jsxs)(n.p,{children:["If you want to enforce eager connection, you will need to define a new middleware and manually call ",(0,r.jsx)(n.code,{children:"await db().connect();"})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8296(e,n,a){a.d(n,{A:()=>T});var t=a(3696),r=a(1750),s=a(3237),o=a(766),i=a(9519),l=a(4395),c=a(5043),u=a(4544),d=a(7454);function p(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:a,default:t}})=>({value:e,label:n,attributes:a,default:t}))}(a);return function(e){const n=(0,u.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,a])}function b({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const a=(0,i.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(r),(0,t.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})},[r,a])]}function f(e){const{defaultValue:n,queryString:a=!1,groupId:r}=e,s=h(e),[o,i]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!b({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=n.find(e=>e.default)??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:s})),[c,u]=m({queryString:a,groupId:r}),[p,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,r]=(0,d.Dv)(n);return[a,(0,t.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),g=(()=>{const e=c??p;return b({value:e,tabValues:s})?e:null})();(0,l.A)(()=>{g&&i(g)},[g]);return{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!b({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),f(e)},[u,f,s]),tabValues:s}}var g=a(6681);const v="tabList_J5MA",x="tabItem_l0OV";var y=a(2540);function j({className:e,block:n,selectedValue:a,selectValue:t,tabValues:s}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const n=e.currentTarget,r=i.indexOf(n),o=s[r].value;o!==a&&(l(n),t(o))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const a=i.indexOf(e.currentTarget)+1;n=i[a]??i[0];break}case"ArrowLeft":{const a=i.indexOf(e.currentTarget)-1;n=i[a]??i[i.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:t})=>(0,y.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{i.push(e)},onKeyDown:u,onClick:c,...t,className:(0,r.A)("tabs__item",x,t?.className,{"tabs__item--active":a===e}),children:n??e},e))})}function w({lazy:e,children:n,selectedValue:a}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===a);return e?(0,t.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function k(e){const n=f(e);return(0,y.jsxs)("div",{className:(0,r.A)(s.G.tabs.container,"tabs-container",v),children:[(0,y.jsx)(j,{...n,...e}),(0,y.jsx)(w,{...n,...e})]})}function T(e){const n=(0,g.A)();return(0,y.jsx)(k,{...e,children:p(e.children)},String(n))}}}]);