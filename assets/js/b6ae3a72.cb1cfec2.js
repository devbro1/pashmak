"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[530],{3023:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var t=n(3696);const s={},o=t.createContext(s);function a(e){const r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:r},e.children)}},7460:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"tutorial-basics/Routing","title":"Router","description":"Pashmak uses facade pattern to simplify access to core components. The Router facade is the main provider of available http routes to http server.","source":"@site/docs/tutorial-basics/Routing.md","sourceDirName":"tutorial-basics","slug":"/tutorial-basics/Routing","permalink":"/pashmak/docs/tutorial-basics/Routing","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/tutorial-basics/Routing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Directory structure","permalink":"/pashmak/docs/tutorial-basics/directory-structure"},"next":{"title":"Controller","permalink":"/pashmak/docs/tutorial-basics/Controller"}}');var s=n(2540),o=n(3023);const a={sidebar_position:4},l="Router",i={},d=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Url structuring",id:"url-structuring",level:2},{value:"URL Resolution",id:"url-resolution",level:2},{value:"Controller Types",id:"controller-types",level:2},{value:"Functional Controllers",id:"functional-controllers",level:3},{value:"Controller class",id:"controller-class",level:3},{value:"Direct Response Manipulation",id:"direct-response-manipulation",level:3},{value:"Accessing Request Data",id:"accessing-request-data",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Built-in HTTP Errors",id:"built-in-http-errors",level:3},{value:"Custom Error Handler",id:"custom-error-handler",level:3},{value:"Nesting Routers",id:"nesting-routers",level:2},{value:"Handling null/undefined in response",id:"handling-nullundefined-in-response",level:3}];function c(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"router",children:"Router"})}),"\n",(0,s.jsx)(r.p,{children:"Pashmak uses facade pattern to simplify access to core components. The Router facade is the main provider of available http routes to http server."}),"\n",(0,s.jsx)(r.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Request, Response } from "@devbro/pashmak/router";\nimport { router } from "@devbro/pashmak/facades";\nimport { CatController } from "@/app/controllers/CatController";\nimport { AnimalController } from "@/app/controllers/AnimalController";\nimport { loggerMiddleware, logResponseMiddleware } from "@/middlewares";\n\n// Add global middleware (applies to all routes)\nrouter().addGlobalMiddleware(loggerMiddleware);\n\n// Add a functional route\nrouter()\n  .addRoute(\n    ["GET", "HEAD"],\n    "/api/v1/countries",\n    async (req: Request, res: Response) => {\n      return { message: "GET countries" };\n    },\n  )\n  .addMiddleware(logResponseMiddleware);\n\n// Register class-based controllers\nrouter().addController(CatController);\n\n// Nesting routers for better organization\nlet authnedRouter = new Router();\nauthnedRouter.addController(AnimalController);\nauthnedRouter.addGlobalMiddleware([authenticate]);\nrouter().addRouter("/api/v1", authnedRouter);\n'})}),"\n",(0,s.jsx)(r.h2,{id:"url-structuring",children:"Url structuring"}),"\n",(0,s.jsx)(r.p,{children:"Pashmak requires valid url structure for routing. Url can be made of following parts:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Static parts: e.g. ",(0,s.jsx)(r.code,{children:"/api/v1/cats"})]}),"\n",(0,s.jsxs)(r.li,{children:["Parameter parts: e.g. ",(0,s.jsx)(r.code,{children:"/api/v1/cats/:id"})," where ",(0,s.jsx)(r.code,{children:":id"})," is a parameter part"]}),"\n",(0,s.jsxs)(r.li,{children:["Wildcard parts: e.g. ",(0,s.jsx)(r.code,{children:"/public/*filepath"})," where ",(0,s.jsx)(r.code,{children:"*filepath"})," matches all remaining parts of url"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Valid name for parameter and wildcard parts are made of alphanumeric characters, and underscore(_). (regex: ",(0,s.jsx)(r.code,{children:"[a-zA-Z0-9_]+"}),"). The value of these parts can be accessed in controller via ",(0,s.jsx)(r.code,{children:"req.params"}),"."]}),"\n",(0,s.jsx)(r.h2,{id:"url-resolution",children:"URL Resolution"}),"\n",(0,s.jsx)(r.p,{children:"For every incoming request, router will try to find the best matching route. If multiple routes match the url, the first registered route will be selected."}),"\n",(0,s.jsx)(r.h2,{id:"controller-types",children:"Controller Types"}),"\n",(0,s.jsx)(r.p,{children:"The router supports two types of controllers:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Functional Controllers"}),": Simple async functions"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Class Controllers"}),": Classes decorated with ",(0,s.jsx)(r.code,{children:"@Controller"})]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"functional-controllers",children:"Functional Controllers"}),"\n",(0,s.jsx)(r.p,{children:"Basic format of a functional controller:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Request, Response } from "@devbro/pashmak/router";\n\nasync (req: Request, res: Response) => {\n  return { message: "GET regions" };\n};\n'})}),"\n",(0,s.jsx)(r.h3,{id:"controller-class",children:"Controller class"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Controller, Get, Post, Put, Delete } from "@devbro/pashmak/router";\nimport { Request, Response } from "@devbro/pashmak/router";\n\n@Controller("/api/v1/cats")\nexport class CatController {\n  @Get("/", { middlewares: [logResponseMiddleware] })\n  async getAllCats() {\n    let req = ctx().get<Request>("request");\n    let res = ctx().get<Response>("response");\n    return { message: "GET all cats" };\n  }\n\n  @Post("/")\n  async createCat() {\n    let req = ctx().get<Request>("request");\n    let res = ctx().get<Response>("response");\n    return { message: "Cat created" };\n  }\n\n  @Put("/:id")\n  async updateCat() {\n    let req = ctx().get<Request>("request");\n    let res = ctx().get<Response>("response");\n    const { id } = req.params;\n    return { message: `Cat ${id} updated` };\n  }\n\n  @Delete("/:id")\n  async deleteCat() {\n    let req = ctx().get<Request>("request");\n    let res = ctx().get<Response>("response");\n    const { id } = req.params;\n    return { message: `Cat ${id} deleted` };\n  }\n\n  @Get(":id/logs")\n  async getCatLogs() {\n    let req = ctx().get<Request>("request");\n    let res = ctx().get<Response>("response");\n    const { id } = req.params;\n    return { message: `Logs for cat ${id}` };\n  }\n}\n'})}),"\n",(0,s.jsx)(r.h3,{id:"direct-response-manipulation",children:"Direct Response Manipulation"}),"\n",(0,s.jsx)(r.p,{children:"For more complex responses, you can directly modify the Response object:"}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Note:"})," Response and Request objects are NOT the standard Node.js objects. Make sure to import them from ",(0,s.jsx)(r.code,{children:"@devbro/pashmak/router"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Request, Response } from "@devbro/pashmak/router";\n\nasync (req: Request, res: Response) => {\n  res.writeHead(418, { "Content-Type": "text/plain" });\n  res.write("Can you guess what I am?");\n};\n'})}),"\n",(0,s.jsx)(r.h2,{id:"accessing-request-data",children:"Accessing Request Data"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"async (req: Request, res: Response) => {\n  const { id } = req.params; // URL parameters\n  const { search } = req.query; // Query string parameters\n  const data = req.body; // Request body\n  const files = req.files; // Uploaded files\n\n  return { id, search, data };\n};\n"})}),"\n",(0,s.jsx)(r.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsxs)(r.p,{children:["The router handles errors automatically. If you throw an error of type ",(0,s.jsx)(r.code,{children:"HttpError"}),", the HTTP server will render it as JSON. If the error is of any other type, the server will return a generic 500 error."]}),"\n",(0,s.jsx)(r.h3,{id:"built-in-http-errors",children:"Built-in HTTP Errors"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Request, Response } from "@devbro/pashmak/router";\nimport {\n  HttpError,\n  HttpBadRequestError,\n  HttpUnauthorizedError,\n  HttpForbiddenError,\n  HttpNotFoundError,\n  HttpConflictError,\n  HttpInternalServerError,\n} from "@devbro/pashmak/http";\n\nasync (req: Request, res: Response) => {\n  // Throw specific HTTP errors\n  throw new HttpUnauthorizedError("Please login first");\n  // or\n  throw new HttpNotFoundError("Resource not found");\n  // or\n  throw new HttpBadRequestError("Invalid input");\n};\n'})}),"\n",(0,s.jsx)(r.h3,{id:"custom-error-handler",children:"Custom Error Handler"}),"\n",(0,s.jsx)(r.p,{children:"You can set a custom error handler for more control:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { httpServer } from "@devbro/pashmak/facades";\nimport { httpServer } from "@devbro/pashmak/http";\n\nhttpServer().setErrorHandler(async (err: Error, req: any, res: any) => {\n  // Custom error handling logic\n  if (err instanceof CustomError) {\n    res.writeHead(err.statusCode, { "Content-Type": "application/json" });\n    res.end(JSON.stringify({ message: "random error" }));\n    return;\n  }\n\n  handleHttpErrors(err, req, res); // optional: call default handler\n});\n'})}),"\n",(0,s.jsx)(r.h2,{id:"nesting-routers",children:"Nesting Routers"}),"\n",(0,s.jsx)(r.p,{children:"There will be situations where we need to simplify your routers using prefix or having\nmiddlewares that are applied to subset of routes. The simple solution is to create a new\nrouter and use addRouter to add it to main router."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { router } from "@devbro/pashmak/facades";\nimport { Router } from "@devbro/pashmak/router"; // Capital Class Name\n\nrouter().addRoute(\n  ["GET", "HEAD"],\n  "/api/v1/meow",\n  async (req: any, res: any) => {\n    return { message: "meow meow!" };\n  },\n);\n\nlet authnedRouter = new Router();\n\n// add routes\nauthnedRouter.addController(OrganizationController);\nauthnedRouter.addController(UserController);\n\n// add middlewares\nauthnedRouter.addGlobalMiddleware([authenticate]);\n\nrouter().addRouter("/api/v1", authnedRouter);\n// or\nrouter().addRouter("", authnedRouter); // prefix can be empty string\n'})}),"\n",(0,s.jsx)(r.h3,{id:"handling-nullundefined-in-response",children:"Handling null/undefined in response"}),"\n",(0,s.jsxs)(r.p,{children:["When returning a json response, ",(0,s.jsx)(r.code,{children:"undefined"})," is not considered a valid value.\nAs a work around, all values of ",(0,s.jsx)(r.code,{children:"undefined"})," will be converted to ",(0,s.jsx)(r.code,{children:"null"})," during\nresponse."]})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);