"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6102],{2325:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>f,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"tutorial-basics/configurations","title":"Configuration","description":"Under the hood, we are using neko-config library to help with managing configuration.","source":"@site/docs/tutorial-basics/configurations.md","sourceDirName":"tutorial-basics","slug":"/tutorial-basics/configurations","permalink":"/pashmak/docs/tutorial-basics/configurations","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/tutorial-basics/configurations.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Installation","permalink":"/pashmak/docs/tutorial-basics/installation"},"next":{"title":"Directory structure","permalink":"/pashmak/docs/tutorial-basics/directory-structure"}}');var i=o(2540),t=o(3023);const a={sidebar_position:2},r="Configuration",c={},l=[{value:"Organizing Configurations",id:"organizing-configurations",level:2},{value:"Database Provider Configurations",id:"database-provider-configurations",level:3},{value:"PostgreSQL Configuration",id:"postgresql-configuration",level:4},{value:"SQLite Configuration",id:"sqlite-configuration",level:4},{value:"NODE_ENV Based Configurations",id:"node_env-based-configurations",level:2},{value:".env AKA dotenv",id:"env-aka-dotenv",level:2},{value:"Enforce values for config to exists",id:"enforce-values-for-config-to-exists",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,i.jsxs)(n.p,{children:["Under the hood, we are using ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/@devbro/neko-config",children:"neko-config"})," library to help with managing configuration."]}),"\n",(0,i.jsxs)(n.p,{children:["By default configs are loaded from ",(0,i.jsx)(n.code,{children:"src/config/default.ts"})," file as a single object. To modify this behavior, you can modify ",(0,i.jsx)(n.code,{children:"src/initialize.ts"})," file."]}),"\n",(0,i.jsx)(n.p,{children:"You can then access your configurations anywhere in your code like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { config } from "@devbro/pashmak/config"; // notice lower case \'c\'\n\nconsole.log(config.get("databases"));\n'})}),"\n",(0,i.jsx)(n.p,{children:"it may become needed to load some values from envvars. to do this, use this approach:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { getEnv } from "@devbro/pashmak/helper";\n// config/default.ts\nexport default {\n  port: process.env.PORT || 3000, // classic way\n  https_port: getEnv("HTTPS_PORT", 443), // better way\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"organizing-configurations",children:"Organizing Configurations"}),"\n",(0,i.jsx)(n.p,{children:"Different features depend on configurations to run successfully, such as database, cache, storage, etc. To maintain clean and organized configurations:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Keep configurations for each feature/service in separate files"}),"\n",(0,i.jsxs)(n.li,{children:["Import them into your default config using ",(0,i.jsx)(n.code,{children:"loadConfig('file_name_without_extension')"})]}),"\n",(0,i.jsx)(n.li,{children:"If using .ts, .js, .mjs, or .mts files, ensure they export default objects. Other possible extensions are .json, .yaml, and .yml which do not require default exports."}),"\n",(0,i.jsx)(n.li,{children:"for facades that can provide multiple connections (like databases, caches, etc.), the main config must be called default."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"An example for databases:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// config/databases.ts or config/database.js\nexport default {\n  default: {\n    provider: 'postgresql',\n    config: {\n      host: process.env.DB_HOST || 'localhost',\n      database: process.env.DB_NAME || 'mydb',\n      user: process.env.DB_USER || 'postgres',\n      password: process.env.DB_PASSWORD,\n      port: parseInt(process.env.DB_PORT || '5432'),\n    },\n  },\n  analytics: {\n    provider: 'sqlite',\n    config: {\n      filename: './analytics.db',\n      readonly: false,\n    },\n  },\n  west_db: {\n    provider: 'mysql',\n    config: {\n      // MySQL config here\n    },\n  },\n};\n\n// config/default.ts\nexport default {\n  databases: loadConfig('databases'),\n  cache: await loadConfig('cache'), // await keyword is optional since pashmak supports async configs\n  // ... other configs\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"database-provider-configurations",children:"Database Provider Configurations"}),"\n",(0,i.jsx)(n.h4,{id:"postgresql-configuration",children:"PostgreSQL Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"{\n  provider: 'postgresql',\n  config: {\n    host: 'localhost',\n    database: 'mydb',\n    user: 'postgres',\n    password: 'password',\n    port: 5432,\n    ssl: false,              // Enable SSL (default: false)\n    max: 20,                 // Max pool size (default: 20)\n    idleTimeoutMillis: 1,    // Time before closing idle connection (default: 1)\n    connectionTimeoutMillis: 30000, // Timeout for acquiring connection (default: 30000)\n    maxUses: 7500,           // Max uses before connection refresh (default: 7500)\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sqlite-configuration",children:"SQLite Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"{\n  provider: 'sqlite',\n  config: {\n    filename: './database.db',  // Path to database file (required)\n    readonly: false,            // Open in readonly mode (default: false)\n    fileMustExist: false,       // Database file must exist (default: false)\n    timeout: 5000,              // Busy timeout in ms (default: 5000)\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"node_env-based-configurations",children:"NODE_ENV Based Configurations"}),"\n",(0,i.jsxs)(n.p,{children:["It is possible to mix and match different configuration files based on the ",(0,i.jsx)(n.code,{children:"NODE_ENV"})," value. Simply export ",(0,i.jsx)(n.code,{children:"$NODE_ENV"})," named exports from your configuration files. If a matching export is found, it will be merged with the default export."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// config/payment.ts\nexport default {\n  provider: "stripe",\n  apiKey: "PLEASE_REPLACE_ME",\n  webhookSecret: "PLEASE_REPLACE_ME",\n};\n\n// NODE_ENV = \'dev\'\nexport const $dev = {\n  apiKey: "sk_dev_XXXXXXXXXXXXXXXXXXXX",\n  webhookSecret: "whsec_dev_XXXXXXXXXXXXXXXXXXXX",\n};\n\n// NODE_ENV = \'test\'\nexport const $test = {\n  provider: "stripe",\n  apiKey: "sk_test_XXXXXXXXXXXXXXXXXXXX",\n  webhookSecret: "whsec_test_XXXXXXXXXXXXXXXXXXXX",\n};\n\n// NODE_ENV = \'prod\'\nexport const $prod = {\n  provider: "stripe",\n  apiKey: process.env.STRIPE_API_KEY,\n  webhookSecret: process.env.STRIPE_WEBHOOK_SECRET,\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"env-aka-dotenv",children:".env AKA dotenv"}),"\n",(0,i.jsx)(n.p,{children:"There is also .env support in case you want to load some configs that way. please note, you will still need to add the specific configs you want to default.js to be able to access the values."}),"\n",(0,i.jsx)(n.h2,{id:"enforce-values-for-config-to-exists",children:"Enforce values for config to exists"}),"\n",(0,i.jsx)(n.p,{children:"some configs are essential and you want to stop the process without them. If these values need to come from envar, you can do this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { getEnv } from "@devbro/pashmak/helper";\n\nexport default {\n  https_port: getEnv("HTTPS_PORT", 443), // will return 443 if not defined\n  port: getEnv("PORT"), // will throw an error if PORT is not defined\n  ssh_port: getEnv("SSH_PORT", undefined), // will return undefined if not defined\n};\n'})})]})}function f(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3023:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>r});var s=o(3696);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);