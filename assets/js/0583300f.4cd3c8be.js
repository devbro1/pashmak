"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8198],{3023(e,n,t){t.d(n,{R:()=>s,x:()=>r});var a=t(3696);const o={},i=a.createContext(o);function s(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(i.Provider,{value:n},e.children)}},6782(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"going-deeper/api-documentation","title":"API Documentation Generation","description":"Pashmak includes a built-in command to help you generate OpenAPI 3.0 documentation. This makes it easy to maintain up-to-date API documentation without manual effort.","source":"@site/docs/going-deeper/api-documentation.md","sourceDirName":"going-deeper","slug":"/going-deeper/api-documentation","permalink":"/pashmak/docs/going-deeper/api-documentation","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/going-deeper/api-documentation.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"Validation","permalink":"/pashmak/docs/going-deeper/validation"},"next":{"title":"Database/ORM","permalink":"/pashmak/docs/category/databaseorm"}}');var o=t(2540),i=t(3023);const s={sidebar_position:12},r="API Documentation Generation",d={},c=[{value:"Configuration",id:"configuration",level:2},{value:"Available Commands",id:"available-commands",level:2},{value:"Registering Actual OpenApi Route",id:"registering-actual-openapi-route",level:2},{value:"Creating Examples from Tests",id:"creating-examples-from-tests",level:2},{value:"Generating different apidocs",id:"generating-different-apidocs",level:2},{value:"Best practices",id:"best-practices",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"api-documentation-generation",children:"API Documentation Generation"})}),"\n",(0,o.jsx)(n.p,{children:"Pashmak includes a built-in command to help you generate OpenAPI 3.0 documentation. This makes it easy to maintain up-to-date API documentation without manual effort."}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// default.ts\nexport default {\n  ???,\n  api_docs: {\n    url: getEnv('API_DOC_URL', 'http://localhost:' + getEnv('PORT', '3000') + '/openapi.json'),\n    merge_files: [\n      path.join(__dirname, '../..', 'private', 'openapi_base.json'),\n      path.join(__dirname, '../..', 'private', 'openapi_examples.json'),\n      path.join(__dirname, '../..', 'private', 'openapi_user_changes.json'),\n    ],\n    output: path.join(__dirname, '../..', 'public', 'openapi.json'),\n  },\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"available-commands",children:"Available Commands"}),"\n",(0,o.jsx)(n.p,{children:"the main assistance comes from command line:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# to generate a basic json file for openapi 3.0 docs\nnpm run generate apidocs --generate-base --output path/to/output.json\n\n# to generate list of routes for all registered routes\nnpm run generate apidocs --generate-from-routes --output path/to/output.json\n\n# merge all files defined in config apidocs.merge_files into one file into apidocs.output\nnpm run generate apidocs --merge-files\n"})}),"\n",(0,o.jsx)(n.h2,{id:"registering-actual-openapi-route",children:"Registering Actual OpenApi Route"}),"\n",(0,o.jsx)(n.p,{children:"If you want to provide a quick page to view your api documents simply add following to your routes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'router.addRoute(\n  ["GET"],\n  "/api/docs",\n  ApiDocumentation(config.getOrFail("api_docs.url"), "rapidoc"),\n);\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Currently you can use ",(0,o.jsx)(n.code,{children:"rapidoc"})," or ",(0,o.jsx)(n.code,{children:"redoc"})," for rendering."]}),"\n",(0,o.jsx)(n.h2,{id:"creating-examples-from-tests",children:"Creating Examples from Tests"}),"\n",(0,o.jsxs)(n.p,{children:["You can use your tests to generate examples for api-docs. To do so, just pass a response object from supertest to ",(0,o.jsx)(n.code,{children:"saveForApiDoc"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import supertest from "supertest";\nimport { httpServer } from "@devbro/pashmak/facades";\nimport { saveForApiDoc } from "./helpers";\n\nconst server = httpServer();\nconst s = supertest(server.getHttpHanlder());\n\nlet updateResponse = await s\n  .put(`/api/v1/cats/${cat_id}`)\n  .set("Authorization", `Bearer ${accessToken}`)\n  .send({\n    name: "Mainecoon",\n    weight: "100KG",\n  });\n\nawait saveForApiDoc(updateResponse, {\n  example_name: "Updating a cat breed details",\n  tags: ["Cats"],\n  routePath: "/api/v1/cats/:id",\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"The code for this method is part of your project so you can make adjustments as needed. Here are some details to have in mind:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You can pass name of example and tags to help organize your examples."}),"\n",(0,o.jsx)(n.li,{children:"routePath is optional but strongly recommended to be passed. Currently the method cannot determine which part is url parameter so this is needd to determine which route the example should be added for."}),"\n",(0,o.jsxs)(n.li,{children:["If ",(0,o.jsx)(n.code,{children:"Authorization"})," header exists, it will automatically mark the endpoint as authentication required."]}),"\n",(0,o.jsx)(n.li,{children:"It can be beneficial to have tests with apidocs tagged to improve performance of document generation"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"generating-different-apidocs",children:"Generating different apidocs"}),"\n",(0,o.jsx)(n.p,{children:"There may be situations that you want to generate different sets of api-docs. An example of this would be when you want to generate one for public release, another one for internal use, and a third for pen testers. To make this you can create multiple entries in your config file:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// src/config/default.ts\nexport default {\n  ???,\n  api_docs: ???,\n  api_docs_internal: ???,\n  pen_testers: {\n    api_docs: ???,\n  },\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"once you have different configs, you can run different merge commands:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# use api_docs as default\nnpm run generate apidocs --merge-files\n\n# use api_docs_internal for merge process\nnpm run generate apidocs --merge-files --config api_docs_internal\n\n# use { pen_testers: { api_docs: ??? } } for merge process\nnpm run generate apidocs --merge-files --config pen_testers.api_docs\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best practices"}),"\n",(0,o.jsx)(n.p,{children:"Pashmak creates api docs by merging multiple json files into a single api doc file. As a result you can\nhave each portion of the doc created separately."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use base api doc to start. it is the fastest way to start with documentations"}),"\n",(0,o.jsx)(n.li,{children:"Keep different portions of api docs based on how they need to be generated. Examples can be generated independently so have those parts in different parts."}),"\n",(0,o.jsx)(n.li,{children:"Opt for statically created api-docs. This way you can control what your end users see and not disclose endpoints that are not meant for external users."}),"\n",(0,o.jsx)(n.li,{children:"Use tests to create your examples. This is beneficials to save time in managing api-docs and give actual examples that work!"}),"\n",(0,o.jsx)(n.li,{children:"Add CI pipelines to autogenerate and commit your new api docs."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);