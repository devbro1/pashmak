"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1905],{2261:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"going-deeper/facades","title":"Facades","description":"Facades in Pashmak provide a clean, convenient interface to access framework services. They act as static-like proxies to underlying service instances, giving you a simple and expressive syntax while maintaining flexibility and testability.","source":"@site/docs/going-deeper/facades.md","sourceDirName":"going-deeper","slug":"/going-deeper/facades","permalink":"/pashmak/docs/going-deeper/facades","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/going-deeper/facades.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Context","permalink":"/pashmak/docs/going-deeper/context"},"next":{"title":"Email","permalink":"/pashmak/docs/going-deeper/email"}}');var i=n(2540),r=n(3023);const t={sidebar_position:2},c="Facades",l={},o=[{value:"What are Facades?",id:"what-are-facades",level:2},{value:"Why Use Facades?",id:"why-use-facades",level:2},{value:"Available Facades",id:"available-facades",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Importing Facades",id:"importing-facades",level:3},{value:"Using Facades",id:"using-facades",level:3},{value:"1. Direct Method Access (Recommended)",id:"1-direct-method-access-recommended",level:4},{value:"2. Function Call Syntax",id:"2-function-call-syntax",level:4},{value:"Working with Multiple Instances",id:"working-with-multiple-instances",level:2},{value:"Cache Example",id:"cache-example",level:3},{value:"Storage Example",id:"storage-example",level:3},{value:"Database Example",id:"database-example",level:3},{value:"Logger Example",id:"logger-example",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Logger in Middleware",id:"logger-in-middleware",level:3},{value:"Cache in Service",id:"cache-in-service",level:3},{value:"Storage in Controller",id:"storage-in-controller",level:3},{value:"Multiple Facades Together",id:"multiple-facades-together",level:3},{value:"How Facades Work",id:"how-facades-work",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Direct Method Access",id:"1-use-direct-method-access",level:3},{value:"2. Use Labeled Instances for Separation",id:"2-use-labeled-instances-for-separation",level:3},{value:"3. Configure in Config Files",id:"3-configure-in-config-files",level:3},{value:"4. Consistent Import Style",id:"4-consistent-import-style",level:3},{value:"Testing with Facades",id:"testing-with-facades",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.header,{children:(0,i.jsx)(a.h1,{id:"facades",children:"Facades"})}),"\n",(0,i.jsx)(a.p,{children:"Facades in Pashmak provide a clean, convenient interface to access framework services. They act as static-like proxies to underlying service instances, giving you a simple and expressive syntax while maintaining flexibility and testability."}),"\n",(0,i.jsx)(a.h2,{id:"what-are-facades",children:"What are Facades?"}),"\n",(0,i.jsx)(a.p,{children:"A facade is a design pattern that provides a simplified interface to complex subsystems. In Pashmak, facades allow you to access framework features without worrying about instantiation, configuration, or dependency management. The framework handles all the complexity behind the scenes."}),"\n",(0,i.jsx)(a.h2,{id:"why-use-facades",children:"Why Use Facades?"}),"\n",(0,i.jsx)(a.p,{children:"Facades offer several benefits:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Simple API"}),": Clean, memorable syntax for accessing services"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Singleton Management"}),": Automatic handling of service instances"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Lazy Initialization"}),": Services are only created when needed"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Multiple Instances"}),": Support for labeled instances (e.g., multiple databases or caches)"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Flexible Syntax"}),": Both function call and direct method access patterns"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Context Awareness"}),": Integration with Pashmak's context system"]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"available-facades",children:"Available Facades"}),"\n",(0,i.jsx)(a.p,{children:"Pashmak provides the following built-in facades:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"router"})," - HTTP routing and controller registration"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"httpServer"})," - HTTP server configuration"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"logger"})," - Logging service"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"db"})," - Database connections"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"cache"})," - Caching service"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"storage"})," - File storage operations"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"mailer"})," - Email sending"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"queue"})," - Background job queues"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"scheduler"})," - Task scheduling"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"cli"})," - Command-line interface"]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(a.h3,{id:"importing-facades",children:"Importing Facades"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger, cache, storage } from "@devbro/pashmak/facades";\n'})}),"\n",(0,i.jsx)(a.h3,{id:"using-facades",children:"Using Facades"}),"\n",(0,i.jsx)(a.p,{children:"Pashmak facades support two calling patterns:"}),"\n",(0,i.jsx)(a.h4,{id:"1-direct-method-access-recommended",children:"1. Direct Method Access (Recommended)"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger, cache, storage } from "@devbro/pashmak/facades";\n\n// Logger\nlogger.info("Application started"); // alias for logger(\'default\').info()\nlogger.error({ msg: "Error occurred", error: err }); // alias for logger(\'default\').error()\n\n// Cache\nawait cache.put("key", "value"); // alias for cache(\'default\').put()\nconst value = await cache.get("key"); // alias for cache(\'default\').get()\n\n// Storage\nawait storage.put("file.txt", "content"); // alias for storage(\'default\').put()\nconst content = await storage.get("file.txt"); // alias for storage(\'default\').get()\n'})}),"\n",(0,i.jsx)(a.h4,{id:"2-function-call-syntax",children:"2. Function Call Syntax"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger, cache, storage } from "@devbro/pashmak/facades";\n\n// Logger\nlogger().info("Application started"); // alias for logger(\'default\').info()\n\n// Cache\nawait cache().put("key", "value"); // alias for cache(\'default\').put()\nconst value = await cache().get("key"); // alias for cache(\'default\').get()\n\n// Storage\nawait storage().put("file.txt", "content"); // alias for storage(\'default\').put()\nconst content = await storage().get("file.txt"); // alias for storage(\'default\').get()\n'})}),"\n",(0,i.jsx)(a.p,{children:"Both patterns access the same default instance and are functionally equivalent."}),"\n",(0,i.jsx)(a.h2,{id:"working-with-multiple-instances",children:"Working with Multiple Instances"}),"\n",(0,i.jsx)(a.p,{children:"Many facades support labeled instances, allowing you to work with multiple configurations:"}),"\n",(0,i.jsx)(a.h3,{id:"cache-example",children:"Cache Example"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// app/config/cache.ts\nexport default {\n  default: {\n    provider: "redis",\n    config: { url: "redis://localhost:6379" },\n  },\n  shared_config: {\n    provider: "redis",\n    config: { url: "redis://localhost:6380" },\n  },\n};\n'})}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { cache } from "@devbro/pashmak/facades";\n\n// Use default cache\nawait cache.put("user:1", userData);\nawait cache().put("user:2", userData2); // Same as above\nawait cache("default").put("user:2", userData2); // Same as above\n\n// Use shared_config cache\nawait cache("shared_config").get("system_maintenance");\n'})}),"\n",(0,i.jsx)(a.h3,{id:"storage-example",children:"Storage Example"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// app/config/storage.ts\nexport default {\n  default: {\n    provider: "local",\n    config: { basePath: "/var/app/storage" },\n  },\n  uploads: {\n    provider: "s3",\n    config: { bucket: "my-uploads" },\n  },\n};\n'})}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { storage } from "@devbro/pashmak/facades";\n\n// Use default storage\nawait storage.put("logs/app.log", logData);\n\n// Use uploads storage\nawait storage("uploads").put("images/photo.jpg", imageBuffer);\n'})}),"\n",(0,i.jsx)(a.h3,{id:"database-example",children:"Database Example"}),"\n",(0,i.jsxs)(a.p,{children:["The ",(0,i.jsx)(a.code,{children:"db"})," facade is slightly different as it's context-aware:"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { db } from "@devbro/pashmak/facades";\n\n// Use default database connection\nconst users = await db().select("*").from("users");\n\n// Use a specific labeled connection\nconst analytics = await db("analytics").select("*").from("events");\n'})}),"\n",(0,i.jsx)(a.h3,{id:"logger-example",children:"Logger Example"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// app/config/logger.ts\nexport default {\n  default: {\n    level: "info",\n  },\n  audit: {\n    level: "debug",\n  },\n};\n'})}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger } from "@devbro/pashmak/facades";\n\n// Use default logger\nlogger.info("Application event");\n\n// Use audit logger\nlogger("audit").debug({ msg: "User action", userId: 123, action: "login" });\n'})}),"\n",(0,i.jsx)(a.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,i.jsx)(a.h3,{id:"logger-in-middleware",children:"Logger in Middleware"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger } from "@devbro/pashmak/facades";\nimport { Request, Response } from "@devbro/pashmak/router";\n\nexport async function loggerMiddleware(\n  req: Request,\n  res: Response,\n  next: () => Promise<void>,\n): Promise<void> {\n  logger.info({\n    msg: "Incoming HTTP Request",\n    method: req.method,\n    url: req.url,\n  });\n  await next();\n}\n'})}),"\n",(0,i.jsx)(a.h3,{id:"cache-in-service",children:"Cache in Service"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { cache } from "@devbro/pashmak/facades";\n\nexport class UserService {\n  async getUserById(id: number) {\n    // Try to get from cache first\n    const cached = await cache.get(`user:${id}`);\n    if (cached) return cached;\n\n    // Fetch from database\n    const user = await db().select("*").from("users").where("id", id).first();\n\n    // Store in cache for 1 hour\n    await cache.put(`user:${id}`, user, 3600);\n\n    return user;\n  }\n}\n'})}),"\n",(0,i.jsx)(a.h3,{id:"storage-in-controller",children:"Storage in Controller"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { Controller, Post } from "@devbro/pashmak/router";\nimport { storage } from "@devbro/pashmak/facades";\nimport { ctx } from "@devbro/pashmak/context";\nimport { Request } from "@devbro/pashmak/router";\n\n@Controller("/api/uploads")\nexport class UploadController {\n  @Post("/")\n  async upload() {\n    const req = ctx().get<Request>("request");\n    const file = req.body.file;\n\n    // Save to storage\n    await storage("uploads").put(file.name, file.buffer);\n\n    return { success: true, filename: file.name };\n  }\n}\n'})}),"\n",(0,i.jsx)(a.h3,{id:"multiple-facades-together",children:"Multiple Facades Together"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { logger, cache, db } from "@devbro/pashmak/facades";\n\nexport async function getCachedData(key: string) {\n  try {\n    // Check cache first\n    const cached = await cache.get(key);\n    if (cached) {\n      logger.debug({ msg: "Cache hit", key });\n      return cached;\n    }\n\n    // Fetch from database\n    logger.debug({ msg: "Cache miss, fetching from DB", key });\n    const data = await db().select("*").from("data").where("key", key).first();\n\n    // Store in cache\n    if (data) {\n      await cache.put(key, data, 3600);\n    }\n\n    return data;\n  } catch (error) {\n    logger.error({ msg: "Error fetching data", key, error });\n    throw error;\n  }\n}\n'})}),"\n",(0,i.jsx)(a.h2,{id:"how-facades-work",children:"How Facades Work"}),"\n",(0,i.jsxs)(a.p,{children:["Under the hood, Pashmak facades use the ",(0,i.jsx)(a.code,{children:"createSingleton"})," helper combined with ",(0,i.jsx)(a.code,{children:"wrapSingletonWithAccessors"})," to provide their dual syntax:"]}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Singleton Management"}),": Each facade maintains a single instance (per label) that's created on first access"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Lazy Initialization"}),": Instances are only created when you first use them"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Property Accessors"}),": Methods are automatically proxied to the default instance"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Context Integration"}),": Some facades (like ",(0,i.jsx)(a.code,{children:"db"}),") integrate with Pashmak's context system"]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"This design gives you the convenience of static access with the flexibility of dependency injection and testing."}),"\n",(0,i.jsx)(a.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(a.h3,{id:"1-use-direct-method-access",children:"1. Use Direct Method Access"}),"\n",(0,i.jsx)(a.p,{children:"The direct method syntax is cleaner and more readable:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// Good\nlogger.info("Message");\nawait cache.put("key", "value");\n\n// Also works, but more verbose\nlogger().info("Message");\nawait cache().put("key", "value");\n'})}),"\n",(0,i.jsx)(a.h3,{id:"2-use-labeled-instances-for-separation",children:"2. Use Labeled Instances for Separation"}),"\n",(0,i.jsx)(a.p,{children:"When you have different use cases, create labeled instances:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// Good - separate concerns\nawait cache("sessions").put(sessionId, sessionData);\nawait cache("api").put(cacheKey, apiResponse);\n\n// Avoid - mixing concerns in default instance\nawait cache().put(`session:${sessionId}`, sessionData);\nawait cache().put(`api:${cacheKey}`, apiResponse);\n'})}),"\n",(0,i.jsx)(a.h3,{id:"3-configure-in-config-files",children:"3. Configure in Config Files"}),"\n",(0,i.jsx)(a.p,{children:"Always configure facades in your config files rather than inline:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// Good - app/config/cache.ts\nexport default {\n  default: { provider: "redis", config: { url: process.env.REDIS_URL } },\n};\n\n// Avoid - inline configuration\n// Not supported by facades\n'})}),"\n",(0,i.jsx)(a.h3,{id:"4-consistent-import-style",children:"4. Consistent Import Style"}),"\n",(0,i.jsx)(a.p,{children:"Import all facades from the same location:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'// Good\nimport { logger, cache, storage } from "@devbro/pashmak/facades";\n\n// Avoid\nimport { logger } from "@devbro/pashmak/facades";\nimport { cache } from "@devbro/pashmak/facades";\nimport { storage } from "@devbro/pashmak/facades";\n'})}),"\n",(0,i.jsx)(a.h2,{id:"testing-with-facades",children:"Testing with Facades"}),"\n",(0,i.jsx)(a.p,{children:"Facades are designed to be testable. In tests, you can:"}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsx)(a.li,{children:"Import facades normally - they'll use test configurations"}),"\n",(0,i.jsx)(a.li,{children:"Mock facade methods when needed"}),"\n",(0,i.jsx)(a.li,{children:"Use different labeled instances for test isolation"}),"\n"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { describe, test, expect } from "vitest";\nimport { cache } from "@devbro/pashmak/facades";\n\ndescribe("UserService", () => {\n  test("should cache user data", async () => {\n    // Facades work normally in tests\n    await cache.put("test:user:1", { id: 1, name: "Test" });\n    const cached = await cache.get("test:user:1");\n\n    expect(cached).toEqual({ id: 1, name: "Test" });\n  });\n});\n'})}),"\n",(0,i.jsx)(a.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/logger",children:"Logger"})," - Detailed logging documentation"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/cache",children:"Cache"})," - Caching strategies and providers"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/file-storage",children:"File Storage"})," - Storage operations and providers"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/email",children:"Email"})," - Mailer configuration and usage"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/queue",children:"Queue"})," - Background job processing"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/scheduler",children:"Scheduler"})," - Task scheduling"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.a,{href:"/pashmak/docs/going-deeper/context",children:"Context"})," - Understanding Pashmak's context system"]}),"\n"]})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3023:(e,a,n)=>{n.d(a,{R:()=>t,x:()=>c});var s=n(3696);const i={},r=s.createContext(i);function t(e){const a=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);