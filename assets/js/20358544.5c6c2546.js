"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1772],{3023(e,n,s){s.d(n,{R:()=>t,x:()=>d});var r=s(3696);const a={},l=r.createContext(a);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(l.Provider,{value:n},e.children)}},9532(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"going-deeper/scheduler","title":"Scheduler and Cron Jobs","description":"Every system needs to run some tasks periodically. Pashmak provides a simple way to define and run scheduled tasks using cron syntax.","source":"@site/docs/going-deeper/scheduler.md","sourceDirName":"going-deeper","slug":"/going-deeper/scheduler","permalink":"/pashmak/docs/going-deeper/scheduler","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/going-deeper/scheduler.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Queue and Messaging","permalink":"/pashmak/docs/going-deeper/queue"},"next":{"title":"Cache","permalink":"/pashmak/docs/going-deeper/cache"}}');var a=s(2540),l=s(3023);const t={sidebar_position:9},d="Scheduler and Cron Jobs",c={},o=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Cron Syntax",id:"cron-syntax",level:2},{value:"Common Examples",id:"common-examples",level:3},{value:"Scheduler Methods",id:"scheduler-methods",level:2},{value:"start() and stop()",id:"start-and-stop",level:3},{value:"getSchedules()",id:"getschedules",level:3},{value:"findSchedule(name)",id:"findschedulename",level:3},{value:"getScheduleNames()",id:"getschedulenames",level:3},{value:"setErrorHandler(handler)",id:"seterrorhandlerhandler",level:3},{value:"setContextWrapper(func)",id:"setcontextwrapperfunc",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Running the Scheduler",id:"running-the-scheduler",level:2}];function i(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"scheduler-and-cron-jobs",children:"Scheduler and Cron Jobs"})}),"\n",(0,a.jsx)(n.p,{children:"Every system needs to run some tasks periodically. Pashmak provides a simple way to define and run scheduled tasks using cron syntax."}),"\n",(0,a.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { scheduler } from "@devbro/pashmak/facades";\n\nscheduler()\n  .call(async () => {\n    console.log("This runs every minute");\n  })\n  .setCronTime("* * * * *")\n  .setName("cleanup cron job")\n  .setRunOnStart(true);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"cron-syntax",children:"Cron Syntax"}),"\n",(0,a.jsx)(n.p,{children:"The cron syntax follows the standard format:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"* * * * *\n\u2502 \u2502 \u2502 \u2502 \u2502\n\u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500 Day of week (0-7, where 0 and 7 are Sunday)\n\u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500 Month (1-12)\n\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Day of month (1-31)\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Hour (0-23)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Minute (0-59)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"common-examples",children:"Common Examples"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// Every minute\nscheduler().call(handler).setCronTime("* * * * *");\n\n// Every hour at minute 0\nscheduler().call(handler).setCronTime("0 * * * *");\n\n// Every day at midnight\nscheduler().call(handler).setCronTime("0 0 * * *");\n\n// Every Monday at 9 AM\nscheduler().call(handler).setCronTime("0 9 * * 1");\n\n// Every 15 minutes\nscheduler().call(handler).setCronTime("*/15 * * * *");\n\n// First day of every month at midnight\nscheduler().call(handler).setCronTime("0 0 1 * *");\n'})}),"\n",(0,a.jsx)(n.h2,{id:"scheduler-methods",children:"Scheduler Methods"}),"\n",(0,a.jsx)(n.h3,{id:"start-and-stop",children:"start() and stop()"}),"\n",(0,a.jsx)(n.p,{children:"Control the scheduler's execution:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { scheduler } from "@devbro/pashmak/facades";\n\n// Start all scheduled tasks\nscheduler().start();\n\n// Stop all scheduled tasks\nscheduler().stop();\n'})}),"\n",(0,a.jsx)(n.h3,{id:"getschedules",children:"getSchedules()"}),"\n",(0,a.jsx)(n.p,{children:"Get all currently registered schedules:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const schedules = scheduler().getSchedules();\nconsole.log(`Found ${schedules.length} scheduled tasks`);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"findschedulename",children:"findSchedule(name)"}),"\n",(0,a.jsx)(n.p,{children:"Find a specific schedule by its name:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const schedule = scheduler().findSchedule("cleanup cron job");\nif (schedule) {\n  console.log("Schedule found");\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Schedules must have a name set via ",(0,a.jsx)(n.code,{children:".setName()"})," to be findable."]}),"\n",(0,a.jsx)(n.h3,{id:"getschedulenames",children:"getScheduleNames()"}),"\n",(0,a.jsx)(n.p,{children:"Get all schedule names:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const names = scheduler().getScheduleNames();\nconsole.log("Scheduled tasks:", names);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"seterrorhandlerhandler",children:"setErrorHandler(handler)"}),"\n",(0,a.jsx)(n.p,{children:"Set a global error handler for all scheduled tasks:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { logger } from "@devbro/pashmak/facades";\n\nscheduler().setErrorHandler(async (error, scheduleName) => {\n  logger().error({\n    msg: "Scheduled task failed",\n    scheduleName,\n    error: error.message,\n  });\n\n  // Send notification, log to external service, etc.\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"setcontextwrapperfunc",children:"setContextWrapper(func)"}),"\n",(0,a.jsx)(n.p,{children:"Set a custom context wrapper function. This is an advanced feature for switching the context provider:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"scheduler().setContextWrapper((fn) => {\n  // Your custom context wrapper implementation\n  return fn();\n});\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Warning:"})," Only use this if you understand the context management system."]}),"\n",(0,a.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// src/schedulers.ts\nimport { scheduler } from "@devbro/pashmak/facades";\nimport { logger } from "@devbro/pashmak/facades";\nimport { User } from "./app/models/User";\n\n// Clean up old sessions every day at 2 AM\nscheduler()\n  .call(async () => {\n    logger().info("Starting session cleanup");\n    const deleted = await Session.deleteOlderThan(30); // days\n    logger().info({ msg: "Session cleanup complete", deleted });\n  })\n  .setCronTime("0 2 * * *")\n  .setName("session_cleanup")\n  .setRunOnStart(false);\n\n// Send daily digest emails every day at 8 AM\nscheduler()\n  .call(async () => {\n    logger().info("Sending daily digest emails");\n    const users = await User.getActiveUsers();\n    for (const user of users) {\n      await sendDigestEmail(user);\n    }\n    logger().info({ msg: "Digest emails sent", count: users.length });\n  })\n  .setCronTime("0 8 * * *")\n  .setName("daily_digest")\n  .setRunOnStart(false);\n\n// Health check every 5 minutes\nscheduler()\n  .call(async () => {\n    const healthy = await performHealthCheck();\n    if (!healthy) {\n      logger().error("Health check failed!");\n    }\n  })\n  .setCronTime("*/5 * * * *")\n  .setName("health_check")\n  .setRunOnStart(true); // Run immediately on startup\n\n// Set error handler\nscheduler().setErrorHandler(async (error, scheduleName) => {\n  logger().error({\n    msg: "Scheduled task error",\n    task: scheduleName,\n    error: error.message,\n    stack: error.stack,\n  });\n});\n'})}),"\n",(0,a.jsx)(n.h2,{id:"running-the-scheduler",children:"Running the Scheduler"}),"\n",(0,a.jsxs)(n.p,{children:["by default, the scheduler is start when the http server using ",(0,a.jsx)(n.code,{children:"--all"})," flag."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm run pdev start --all\n# or\nyarn pdev start --scheduler\n# or\npnpm pdev start --cron # alternative name for --scheduler\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}}}]);