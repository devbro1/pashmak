"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[916],{3023:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>a});var i=n(3696);const t={},o=i.createContext(t);function s(e){const r=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(o.Provider,{value:r},e.children)}},9804:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"going-deeper/middlewares","title":"Middleware","description":"Just like many other web frameworks, Pashmak supports middlewares. Middlewares are pieces of code that wrap execution of controller methods. They can be used for various purposes such as authentication, logging, request modification, response modification, etc.","source":"@site/docs/going-deeper/middlewares.md","sourceDirName":"going-deeper","slug":"/going-deeper/middlewares","permalink":"/pashmak/docs/going-deeper/middlewares","draft":false,"unlisted":false,"editUrl":"https://github.com/devbro1/pashmak/blob/master/docs/docs/going-deeper/middlewares.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Loggers","permalink":"/pashmak/docs/going-deeper/logger"},"next":{"title":"Queue and Messaging","permalink":"/pashmak/docs/going-deeper/queue"}}');var t=n(2540),o=n(3023);const s={sidebar_position:6},a="Middleware",d={},l=[{value:"types of middleware",id:"types-of-middleware",level:2},{value:"functional middlewares",id:"functional-middlewares",level:3},{value:"Middleware Class",id:"middleware-class",level:3},{value:"Middleware Object",id:"middleware-object",level:3},{value:"order of middleware execution",id:"order-of-middleware-execution",level:2},{value:"creating a functional middleware",id:"creating-a-functional-middleware",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"middleware",children:"Middleware"})}),"\n",(0,t.jsx)(r.p,{children:"Just like many other web frameworks, Pashmak supports middlewares. Middlewares are pieces of code that wrap execution of controller methods. They can be used for various purposes such as authentication, logging, request modification, response modification, etc."}),"\n",(0,t.jsx)(r.h2,{id:"types-of-middleware",children:"types of middleware"}),"\n",(0,t.jsx)(r.p,{children:"There are 3 types of middlewares you can create:"}),"\n",(0,t.jsx)(r.h3,{id:"functional-middlewares",children:"functional middlewares"}),"\n",(0,t.jsxs)(r.p,{children:["similar to expressjs middlewares they are just functions that are executed at each request.\nthe major point is you need to call ",(0,t.jsx)(r.code,{children:"await next()"}),", otherwise you can break the promise chain and cause unpredictable behaviors."]}),"\n",(0,t.jsx)(r.h3,{id:"middleware-class",children:"Middleware Class"}),"\n",(0,t.jsx)(r.p,{children:"it is a class definition that extends Middleware class. Everytime a request is processed, a new instance of this class is created before executing the middleware part.\nThis is ideal for when you need to run a middleware where it needs to track some data from before and acter controller execution per each request."}),"\n",(0,t.jsx)(r.h3,{id:"middleware-object",children:"Middleware Object"}),"\n",(0,t.jsx)(r.p,{children:"There may exists situations where you want to save performance and not instantiate on every request.\nor you want to be able to track data between requests."}),"\n",(0,t.jsx)(r.h2,{id:"order-of-middleware-execution",children:"order of middleware execution"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"from global router"}),"\n",(0,t.jsx)(r.li,{children:"from class middlewares"}),"\n",(0,t.jsx)(r.li,{children:"from request method of controller class"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"creating-a-functional-middleware",children:"creating a functional middleware"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'export async function requirePermissionsMiddleware(\n  required_permissions: Permission | Permission[],\n) {\n  return async function (\n    req: Request,\n    res: Response,\n    next: () => Promise<void>,\n  ): Promise<void> {\n    let auth_user = ctx.get("getAuthenticatedUser");\n\n    canUserOrFail(auth_user, required_permissions);\n\n    try {\n      // if you do not want to handle errors here, you can remove try catch block entirely\n      await next();\n      // post controller code\n    } catch (error) {\n      // error handling code if controller or any other middleware throws an error\n      throw error;\n    }\n  };\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["NOTE: It is very important that you call ",(0,t.jsx)(r.code,{children:"await next()"})," otherwise the promise chain will be broken and the request will not be processed."]})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);